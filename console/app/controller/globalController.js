/*
 * File: app/controller/globalController.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('webapp.controller.globalController', {
    extend: 'Ext.app.Controller',

    init: function(application) {
        /**
         * Global Variables를 정의
         */
        // Memory Chart, CPU Chart 용 Store 정의
        var memoryStore, cpuStore;

        // Memory Chart, CPU Chart 용 Series 겸 Field 정의
        var fields = ['date', 'field1', 'field2', 'field3', 'field4', 'field5', 'field6', 'field7', 'field8'];

        // 최대 Infinispan 서버 갯수
        var serverSize = 8;

        // REST API 호출을 위한 서버 URL Prefix로써 Athena-Dolly-Controller로 Deploy 시 ''로 변경한다.
        //var urlPrefix = 'http://127.0.0.1:8080/controller/';
        var urlPrefix = '';

        // 현재 구동중인 Infinispan 서버 갯수를 조회한다.
        Ext.Ajax.request({
            async: false,
            url: urlPrefix + 'getServerList',
            params: {
            },
            success: function(response, opts){
                var obj = Ext.decode(response.responseText);

                serverSize = obj.length;

                if (obj.length == 1) {
                    fields = ['date', 'field1'];
                } else if (obj.length == 2) {
                    fields = ['date', 'field1', 'field2'];
                } else if (obj.length == 3) {
                    fields = ['date', 'field1', 'field2', 'field3'];
                } else if (obj.length == 4) {
                    fields = ['date', 'field1', 'field2', 'field3', 'field4'];
                } else if (obj.length == 5) {
                    fields = ['date', 'field1', 'field2', 'field3', 'field4', 'field5'];
                } else if (obj.length == 6) {
                    fields = ['date', 'field1', 'field2', 'field3', 'field4', 'field5', 'field6'];
                } else if (obj.length == 7) {
                    fields = ['date', 'field1', 'field2', 'field3', 'field4', 'field5', 'field6', 'field7'];
                }
            },
            failure: function(response, opts) {
                Ext.Msg.alert('Error', 'Server-side failure with status code ' + response.status);
            }
        });

        memoryStore = Ext.create('Ext.data.JsonStore', {
            fields: fields
        });

        cpuStore = Ext.create('Ext.data.JsonStore', {
            fields: fields
        });

        // Global variables를 정의하는 구문으로 GlobalData.urlPrefix, GlobalData.serverSize 등으로 어디에서든 접근이 가능하다.
        Ext.define('GlobalData', {
            singleton: true,

            urlPrefix: urlPrefix,
            memoryStore: memoryStore,
            cpuStore: cpuStore,
            serverSize: serverSize
        });
    }

});
